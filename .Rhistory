if(png==1)#set these to only turn on if you're making PNG graphs
dev.off()
#get canadian imports by PADD
library(stringr)
get_padd_imports<-function(commodity="Crude Oil",freq="M",unit_sent="Thousand Barrels per Day",from="Canada")
{
#function to grab and graph Canadian imports as a share of total imports by PADD
products<-data_fetch(KEY,cat=376801)
sub_cats<-products$Sub_Categories
#find commodity
sub_cats<-sub_cats %>% filter(name%in%c(commodity,str_to_lower(commodity),str_to_title(commodity)))
imports<-data_fetch(KEY,cat=sub_cats$category_id)
areas<-data_fetch(KEY,cat=imports$Sub_Categories$category_id)
areas<-areas$Sub_Categories
#build list from sub_cats
cat_store <- list()
cat_count<-1
for (cat in areas$category_id) {
#cat<-sub_cats$category_id[1]
series<-data_fetch(KEY,cat=cat)
cat_store[[cat_count]]<-series$Series_IDs
cat_count<-cat_count+1
}
series<-tibble(do.call(rbind,cat_store))
#filter for totals and Canada in monthly data
commodity=case_when(
str_to_lower(commodity)==str_to_lower("Total Crude Oil and Products")~"Crude Oil and Petroleum Products",
str_to_lower(commodity)==str_to_lower("Products")~"Total Petroleum Products",
TRUE~commodity
)
series<-series %>% filter(str_to_lower(f)==str_to_lower(freq))%>%
filter(str_to_lower(units)==str_to_lower(unit_sent))%>%
#find the totals
filter(grepl(str_to_lower(paste("Imports by PADD of Processing of",commodity)),str_to_lower(name))
|
grepl(str_to_lower(paste("from",from)),str_to_lower(name)))
#get the data
import_data<-EIA_to_DF(series)%>%
pivot_longer(-date,values_to = "imports")%>%
mutate(date=as_date(date),imports=na.fill(imports,fill = 0),
name=gsub("Imports by PADD of Processing ","",name)
)
import_data<-import_data  %>%
separate(name,c("name","freq"),sep=", ")%>%
separate(name,c("name","commodity"),sep=" of ")%>%
separate(name,c("name","from"),sep=" from ")%>%
replace_na(list(from = "Total"))
#fix the factors
import_data<-import_data%>%
mutate(PADD=as_factor(name),
PADD=fct_relevel(PADD,"Midwest (PADD 2)",after = 1),
from=factor(from),
from=fct_recode(from,c("Total Imports"="Total")),
from=fct_recode(from,c("Imports from Russia"="Russia")),
from=fct_recode(from,c("Imports from Canada"="Canada")),
from=fct_relevel(from,"Total Imports"))
import_data
}
cad_imports<-get_padd_imports()
plot<-grid.arrange(arrangeGrob(moves_in +labs(caption="Note: Production denoted as supply from within the PADD, e.g. PADD 2 production appears as PADD 2 supply from PADD 2.")+
theme(legend.position="none",
legend.margin=margin(c(0,0,0,0),unit="cm"),
legend.text = element_text(colour="black", size = 14, face = "bold"),
plot.caption = element_text(size = 10,face = "plain", colour="black"),
plot.title = element_text(size = 12,face = "bold", colour="black"),
plot.subtitle = element_blank(),
panel.grid.minor = element_blank(),
text = element_text(size = 10,face = "bold"),
axis.text = element_text(size =12,face = "bold", colour="black"),
axis.text.x = element_blank(),
axis.title.x = element_blank(),
strip.text = element_text(colour="black", size = 8, face = "bold"),
),
moves_out+ labs(caption = "Source: Data via EIA, graph by Andrew Leach")+
theme(legend.position="none",
plot.title = element_text(size = 12,face = "bold", colour="black"),
plot.subtitle = element_blank(),
plot.caption = element_blank(),
panel.grid.minor = element_blank(),
text = element_text(size = 10,face = "bold"),
axis.text = element_text(size = 12,face = "bold", colour="black"),
axis.title.x = element_blank(),
strip.text = element_text(colour="black", size = 8, face = "bold"),
axis.title.y = element_text(margin = margin(t = 0, r = 10, b = 0, l = 0))),
ncol=1,heights=c(3,3)),
mylegend,
nrow=2,heights=c(10, 1),
bottom =text_grob(
"Source: Data via EIA, graph by Andrew Leach",
face = "italic", color = "black",size=10,hjust=0.5,vjust=0.5,lineheight = 2
)
#,
#top =text_grob(
#  "US PADD-to-PADD Crude Oil Movements",
#  face = "bold", color = "black",size=14,just="center",lineheight = 1
#)
#
)
plot
ggsave(plot = plot,"movements.png")
ggsave(plot = plot,"movements.png",dpi=300,bg="white",width = 16,height=8)
ggplot(filter(df1,Mode!="Production",From!="International Trade"),aes(date,quantity,group = To,colour=To,fill=To)) +
geom_area(position = "stack")+
facet_grid(~From)+
scale_x_date()+
scale_fill_manual("",values = colors_tableau10()[-7],guide = "legend")+
scale_colour_manual("",values=colors_tableau10()[-7],guide = "legend")+
guides(fill=guide_legend(nrow =1,byrow=FALSE))+
theme_minimal()+theme(
plot.margin = margin(.5, .5, .5, .5, "cm"),
legend.position = "bottom",
legend.margin=margin(c(.10,0,.10,0),unit="cm"),
legend.text = element_text(colour="black", size = 10),
legend.title = element_text(colour="black", size = 14,vjust=0.5),
plot.caption = element_text(size = 12, face = "italic"),
plot.title = element_text(size = 18,face = "bold"),
plot.subtitle = element_text(size = 14, face = "italic"),
panel.grid.minor = element_blank(),
text = element_text(size = 12,face = "bold"),
axis.text.y = element_text(size = 12,face = "bold", colour="black"),
axis.text.x = element_text(size = 12, colour = "black", angle = 90,hjust = 0.5),
strip.text.x = element_text(size = 10, colour = "black", angle = 0)
)+
labs(y="Crude Oil (MMbbl/d)",x="Year",
title=paste("US Crude Oil Destination by Region"),
#subtitle=paste("Production appears as sourced from within a PADD, so PADD 2 production is oil from PADD 2 in PADD 2"),
caption="Source: EIA API, graph by Andrew Leach.")
ggplot(filter(df1,Mode!="Production",From!="International Trade"),aes(date,quantity,group = To,colour=To,fill=To)) +
geom_area(position = "stack")+
facet_grid(~From)+
scale_x_date()+
scale_fill_manual("",values = colors_tableau10()[-7],guide = "legend")+
scale_colour_manual("",values=colors_tableau10()[-7],guide = "legend")+
guides(fill=guide_legend(nrow =1,byrow=FALSE))
ggplot(filter(df1,Mode!="Production",From!="International Trade"),aes(date,quantity,group = To,colour=To,fill=To)) +
geom_area(position = "stack")+
facet_grid(~From)+
scale_x_date()+
scale_fill_manual("",values = colors_tableau10()[-7],guide = "legend")+
scale_colour_manual("",values=colors_tableau10()[-7],guide = "legend")+
guides(fill=guide_legend(nrow =1,byrow=FALSE))+
theme_minimal()
moves_out<-ggplot(filter(df1,Mode!="Production",From!="International Trade"),aes(date,quantity,group = To,colour=To,fill=To)) +
geom_area(position = "stack")+
facet_grid(~From)+
scale_x_date()+
scale_fill_manual("",values = colors_tableau10()[-7],guide = "legend")+
scale_colour_manual("",values=colors_tableau10()[-7],guide = "legend")+
guides(fill=guide_legend(nrow =1,byrow=FALSE))+
theme_minimal()+theme(
plot.margin = margin(.5, .5, .5, .5, "cm"),
legend.position = "bottom",
legend.margin=margin(c(.10,0,.10,0),unit="cm"),
legend.text = element_text(colour="black", size = 10),
legend.title = element_text(colour="black", size = 14,vjust=0.5),
plot.caption = element_text(size = 12, face = "italic"),
plot.title = element_text(size = 18,face = "bold"),
plot.subtitle = element_text(size = 14, face = "italic"),
panel.grid.minor = element_blank(),
text = element_text(size = 12,face = "bold"),
axis.text.y = element_text(size = 12,face = "bold", colour="black"),
axis.text.x = element_text(size = 12, colour = "black", angle = 90,hjust = 0.5),
strip.text.x = element_text(size = 10, colour = "black", angle = 0)
)+
labs(y="Crude Oil (MMbbl/d)",x="Year",
title=paste("US Crude Oil Destination by Region"),
#subtitle=paste("Production appears as sourced from within a PADD, so PADD 2 production is oil from PADD 2 in PADD 2"),
caption="Source: EIA API, graph by Andrew Leach.")
print(moves_out)
moves_out<-ggplot(filter(df1,Mode!="Production",From!="International Trade"),aes(date,quantity,group = To,colour=To,fill=To)) +
geom_area(position = "stack")+
facet_grid(~From)+
scale_x_date()+
scale_fill_manual("",values = colors_tableau10()[-7],guide = "legend")+
scale_colour_manual("",values=colors_tableau10()[-7],guide = "legend")+
guides(fill=guide_legend(nrow =1,byrow=FALSE))+
theme_minimal()+theme(
plot.margin = margin(.5, .5, .5, .5, "cm"),
legend.position = "bottom",
legend.margin=margin(c(.10,0,.10,0),unit="cm"),
legend.text = element_text(colour="black", size = 10),
legend.title = element_text(colour="black", size = 14,vjust=0.5),
plot.caption = element_text(size = 12, face = "italic"),
plot.title = element_text(size = 18,face = "bold"),
plot.subtitle = element_text(size = 14, face = "italic"),
panel.grid.minor = element_blank(),
text = element_text(size = 12,face = "bold"),
axis.text.y = element_text(size = 12,face = "bold", colour="black"),
#axis.text.x = element_text(size = 12, colour = "black", angle = 90,hjust = 0.5),
strip.text.x = element_text(size = 10, colour = "black", angle = 0)
)+
labs(y="Crude Oil (MMbbl/d)",x="Year",
title=paste("US Crude Oil Destination by Region"),
#subtitle=paste("Production appears as sourced from within a PADD, so PADD 2 production is oil from PADD 2 in PADD 2"),
caption="Source: EIA API, graph by Andrew Leach.")
print(moves_out)
moves_out<-ggplot(filter(df1,Mode!="Production",From!="International Trade"),aes(date,quantity,group = To,colour=To,fill=To)) +
geom_area(position = "stack")+
facet_grid(~From)+
scale_x_date()+
scale_fill_manual("",values = colors_tableau10()[-7],guide = "legend")+
scale_colour_manual("",values=colors_tableau10()[-7],guide = "legend")+
guides(fill=guide_legend(nrow =1,byrow=FALSE))+
theme_minimal()+theme(
plot.margin = margin(.5, .5, .5, .5, "cm"),
legend.position = "bottom",
legend.margin=margin(c(.10,0,.10,0),unit="cm"),
legend.text = element_text(colour="black", size = 10),
legend.title = element_text(colour="black", size = 14,vjust=0.5),
plot.caption = element_text(size = 12, face = "italic"),
plot.title = element_text(size = 18,face = "bold"),
plot.subtitle = element_text(size = 14, face = "italic"),
panel.grid.minor = element_blank(),
text = element_text(size = 12,face = "bold"),
axis.text.y = element_text(size = 12,face = "bold", colour="black"),
axis.text.x = element_text(size = 12, colour = "black", angle = 90,vjust = 0.5),
strip.text.x = element_text(size = 10, colour = "black", angle = 0)
)+
labs(y="Crude Oil (MMbbl/d)",x="Year",
title=paste("US Crude Oil Destination by Region"),
#subtitle=paste("Production appears as sourced from within a PADD, so PADD 2 production is oil from PADD 2 in PADD 2"),
caption="Source: EIA API, graph by Andrew Leach.")
print(moves_out)
moves_out<-ggplot(filter(df1,Mode!="Production",From!="International Trade"),aes(date,quantity,group = To,colour=To,fill=To)) +
geom_area(position = "stack")+
facet_grid(~From)+
scale_x_date(breaks = pretty_breaks(10))+
scale_fill_manual("",values = colors_tableau10()[-7],guide = "legend")+
scale_colour_manual("",values=colors_tableau10()[-7],guide = "legend")+
guides(fill=guide_legend(nrow =1,byrow=FALSE))+
theme_minimal()+theme(
plot.margin = margin(.5, .5, .5, .5, "cm"),
legend.position = "bottom",
legend.margin=margin(c(.10,0,.10,0),unit="cm"),
legend.text = element_text(colour="black", size = 10),
legend.title = element_text(colour="black", size = 14,vjust=0.5),
plot.caption = element_text(size = 12, face = "italic"),
plot.title = element_text(size = 18,face = "bold"),
plot.subtitle = element_text(size = 14, face = "italic"),
panel.grid.minor = element_blank(),
text = element_text(size = 12,face = "bold"),
axis.text.y = element_text(size = 12,face = "bold", colour="black"),
axis.text.x = element_text(size = 12, colour = "black", angle = 90,vjust = 0.5),
strip.text.x = element_text(size = 10, colour = "black", angle = 0)
)+
labs(y="Crude Oil (MMbbl/d)",x="Year",
title=paste("US Crude Oil Destination by Region"),
#subtitle=paste("Production appears as sourced from within a PADD, so PADD 2 production is oil from PADD 2 in PADD 2"),
caption="Source: EIA API, graph by Andrew Leach.")
print(moves_out)
png<-1
if(png==1)#set these to only turn on if you're making PNG graphs
set_png("padd_imports.png")
moves_in<-ggplot(filter(df1,To!="International Trade"),aes(date,quantity,group = From,colour=From,fill=From)) +
geom_area(position = "stack")+
facet_grid(~To)+
scale_x_date(breaks = pretty_breaks(10))+
scale_fill_manual("Source of Crude",values = colors_tableau10()[-7],guide = "legend")+
scale_colour_manual("Source of Crude",values=colors_tableau10()[-7],guide = "legend")+
guides(fill=guide_legend(nrow =2,byrow=FALSE))+
theme_minimal()+theme(
plot.margin = margin(.5, .5, .5, .5, "cm"),
legend.position = "bottom",
legend.margin=margin(c(.10,0,.10,0),unit="cm"),
legend.text = element_text(colour="black", size = 14),
legend.title = element_text(colour="black", size = 14,vjust=0.5),
plot.caption = element_text(size = 12, face = "italic"),
plot.title = element_text(size = 18,face = "bold"),
plot.subtitle = element_text(size = 14, face = "italic"),
panel.grid.minor = element_blank(),
text = element_text(size = 12,face = "bold"),
axis.text.y = element_text(size = 12,face = "bold", colour="black"),
axis.text.x = element_text(size = 12, colour = "black", angle = 90,vjust = 0.5),
strip.text.x = element_text(size = 10, colour = "black", angle = 0)
)+
labs(y="Crude Oil (MMbbl/d)",x="Year",
title=paste("US Crude Oil Source By Region"),
subtitle=paste("Production appears as sourced from within a PADD, so PADD 2 production is oil from PADD 2 in PADD 2"),
caption="Source: EIA API, graph by Andrew Leach.")
print(moves_in)
if(png==1)#set these to only turn on if you're making PNG graphs
dev.off()
if(png==1)#set these to only turn on if you're making PNG graphs
set_png("padd_exports.png")
moves_out<-ggplot(filter(df1,Mode!="Production",From!="International Trade"),aes(date,quantity,group = To,colour=To,fill=To)) +
geom_area(position = "stack")+
facet_grid(~From)+
scale_x_date(breaks = pretty_breaks(10))+
scale_fill_manual("",values = colors_tableau10()[-7],guide = "legend")+
scale_colour_manual("",values=colors_tableau10()[-7],guide = "legend")+
guides(fill=guide_legend(nrow =1,byrow=FALSE))+
theme_minimal()+theme(
plot.margin = margin(.5, .5, .5, .5, "cm"),
legend.position = "bottom",
legend.margin=margin(c(.10,0,.10,0),unit="cm"),
legend.text = element_text(colour="black", size = 10),
legend.title = element_text(colour="black", size = 14,vjust=0.5),
plot.caption = element_text(size = 12, face = "italic"),
plot.title = element_text(size = 18,face = "bold"),
plot.subtitle = element_text(size = 14, face = "italic"),
panel.grid.minor = element_blank(),
text = element_text(size = 12,face = "bold"),
axis.text.y = element_text(size = 12,face = "bold", colour="black"),
axis.text.x = element_text(size = 12, colour = "black", angle = 90,vjust = 0.5),
strip.text.x = element_text(size = 10, colour = "black", angle = 0)
)+
labs(y="Crude Oil (MMbbl/d)",x="Year",
title=paste("US Crude Oil Destination by Region"),
#subtitle=paste("Production appears as sourced from within a PADD, so PADD 2 production is oil from PADD 2 in PADD 2"),
caption="Source: EIA API, graph by Andrew Leach.")
print(moves_out)
if(png==1)#set these to only turn on if you're making PNG graphs
dev.off()
#extract legend
#https://github.com/hadley/ggplot2/wiki/Share-a-legend-between-two-ggplot2-graphs
g_legend<-function(a.gplot){
tmp <- ggplot_gtable(ggplot_build(a.gplot))
leg <- which(sapply(tmp$grobs, function(x) x$name) == "guide-box")
legend <- tmp$grobs[[leg]]
return(legend)}
#grab the legend without a title
mylegend<-arrangeGrob(g_legend(moves_out + theme(legend.title = element_blank(),
legend.spacing = unit(1.0, 'cm'),
legend.text =  element_text(margin = margin(t = 0, r = 1, b = 0, l = 0)))))
plot<-grid.arrange(arrangeGrob(moves_in +labs(caption="Note: Production denoted as supply from within the PADD, e.g. PADD 2 production appears as PADD 2 supply from PADD 2.")+
theme(legend.position="none",
legend.margin=margin(c(0,0,0,0),unit="cm"),
legend.text = element_text(colour="black", size = 14, face = "bold"),
plot.caption = element_text(size = 10,face = "plain", colour="black"),
plot.title = element_text(size = 12,face = "bold", colour="black"),
plot.subtitle = element_blank(),
panel.grid.minor = element_blank(),
text = element_text(size = 10,face = "bold"),
axis.text = element_text(size =12,face = "bold", colour="black"),
axis.text.x = element_blank(),
axis.title.x = element_blank(),
strip.text = element_text(colour="black", size = 8, face = "bold"),
),
moves_out+ labs(caption = "Source: Data via EIA, graph by Andrew Leach")+
theme(legend.position="none",
plot.title = element_text(size = 12,face = "bold", colour="black"),
plot.subtitle = element_blank(),
plot.caption = element_blank(),
panel.grid.minor = element_blank(),
text = element_text(size = 10,face = "bold"),
axis.text = element_text(size = 12,face = "bold", colour="black"),
axis.title.x = element_blank(),
strip.text = element_text(colour="black", size = 8, face = "bold"),
axis.title.y = element_text(margin = margin(t = 0, r = 10, b = 0, l = 0))),
ncol=1,heights=c(3,3)),
mylegend,
nrow=2,heights=c(10, 1),
bottom =text_grob(
"Source: Data via EIA, graph by Andrew Leach",
face = "italic", color = "black",size=10,hjust=0.5,vjust=0.5,lineheight = 2
)
#,
#top =text_grob(
#  "US PADD-to-PADD Crude Oil Movements",
#  face = "bold", color = "black",size=14,just="center",lineheight = 1
#)
#
)
ggsave(plot = plot,"movements.png",dpi=300,bg="white",width = 14,height=8)
subs<-data_fetch(KEY,cat=315918)
sub_cats<-subs$Sub_Categories
data_store <- list()
stack<-1
for (cat in sub_cats$category_id[-1]) {
#for testing
#cat<-sub_cats$category_id[2]
subs<-data_fetch(KEY,cat=cat)
series <-subs$Series_IDs %>% filter(grepl("Monthly",name),units=="Thousand Barrels per Day")
series$name<-as.character(series$name)
series$To<-"Export"
series$From<-do.call("rbind",strsplit(series$name, " Exports of "))[,1]
series$Mode<-"Export"
Rest<-do.call("rbind",strsplit(series$name, " Exports of "))[,2]
series<-series[!grepl("Exports to",Rest),]
Rest<-Rest[!grepl("Exports to",Rest)] #take out exports to the PADD itself - odd
series$Commodity<-do.call("rbind",strsplit(Rest, ", Monthly"))[,1]
series$freq<-"Monthly"
data_store[[stack]]<-series
stack<-stack+1
}
exports_padd<-data.frame(do.call(rbind,data_store))
View(exports_padd)
crude_data<-data.frame(pdfetch_EIA(crude_series$series_id,KEY),stringsAsFactors = F)
View(crude_data)
df1<-movements %>% filter(date>=ymd("1990-01-01") & Commodity=="Crude Oil",To != "U.S.")%>%
mutate(To=factor(To)) %>% mutate(To=fct_collapse(To,
"West Coast (PADD 5)" = c("Federal Offshore PADD 5", "West Coast (PADD 5)"),
"International Trade" = c("Export")
)
) %>%
mutate(From=factor(From)) %>% mutate(From=fct_collapse(From,
"West Coast (PADD 5)" = c("Federal Offshore PADD 5", "West Coast (PADD 5)"),
"International Trade" = c("Import")
)
) %>%
group_by(date,To,From,Commodity,Mode) %>% summarize(quantity=sum(quantity))
#df1$From<-fct_recode(df1$From, "Imports from Canada" = "Canada", "Other Imports" = "Other")
df1$From<- factor(df1$From, levels=c("East Coast (PADD 1)","Midwest (PADD 2)","Gulf Coast (PADD 3)","Rocky Mountain (PADD 4)",
"West Coast (PADD 5)","Production","International Trade"))
df1$To<- factor(df1$To, levels=c("East Coast (PADD 1)","Midwest (PADD 2)","Gulf Coast (PADD 3)","Rocky Mountain (PADD 4)",
"West Coast (PADD 5)","International Trade"))
df_test<-df1 %>% filter(From=="East Coast (PADD 1)")
moves_in<-ggplot(filter(df1,To!="International Trade"),aes(date,quantity,group = From,colour=From,fill=From)) +
geom_area(position = "stack")+
facet_grid(~To)+
scale_x_date(breaks = pretty_breaks(10))+
scale_fill_manual("Source of Crude",values = colors_tableau10()[-7],guide = "legend")+
scale_colour_manual("Source of Crude",values=colors_tableau10()[-7],guide = "legend")+
guides(fill=guide_legend(nrow =2,byrow=FALSE))+
theme_minimal()+theme(
plot.margin = margin(.5, .5, .5, .5, "cm"),
legend.position = "bottom",
legend.margin=margin(c(.10,0,.10,0),unit="cm"),
legend.text = element_text(colour="black", size = 14),
legend.title = element_text(colour="black", size = 14,vjust=0.5),
plot.caption = element_text(size = 12, face = "italic"),
plot.title = element_text(size = 18,face = "bold"),
plot.subtitle = element_text(size = 14, face = "italic"),
panel.grid.minor = element_blank(),
text = element_text(size = 12,face = "bold"),
axis.text.y = element_text(size = 12,face = "bold", colour="black"),
axis.text.x = element_text(size = 12, colour = "black", angle = 90,vjust = 0.5),
strip.text.x = element_text(size = 10, colour = "black", angle = 0)
)+
labs(y="Crude Oil (MMbbl/d)",x="Year",
title=paste("US Crude Oil Source By Region"),
subtitle=paste("Production appears as sourced from within a PADD, so PADD 2 production is oil from PADD 2 in PADD 2"),
caption="Source: EIA API, graph by Andrew Leach.")
print(moves_in)
moves_out<-ggplot(filter(df1,Mode!="Production",From!="International Trade"),aes(date,quantity,group = To,colour=To,fill=To)) +
geom_area(position = "stack")+
facet_grid(~From)+
scale_x_date(breaks = pretty_breaks(10))+
scale_fill_manual("",values = colors_tableau10()[-7],guide = "legend")+
scale_colour_manual("",values=colors_tableau10()[-7],guide = "legend")+
guides(fill=guide_legend(nrow =1,byrow=FALSE))+
theme_minimal()+theme(
plot.margin = margin(.5, .5, .5, .5, "cm"),
legend.position = "bottom",
legend.margin=margin(c(.10,0,.10,0),unit="cm"),
legend.text = element_text(colour="black", size = 10),
legend.title = element_text(colour="black", size = 14,vjust=0.5),
plot.caption = element_text(size = 12, face = "italic"),
plot.title = element_text(size = 18,face = "bold"),
plot.subtitle = element_text(size = 14, face = "italic"),
panel.grid.minor = element_blank(),
text = element_text(size = 12,face = "bold"),
axis.text.y = element_text(size = 12,face = "bold", colour="black"),
axis.text.x = element_text(size = 12, colour = "black", angle = 90,vjust = 0.5),
strip.text.x = element_text(size = 10, colour = "black", angle = 0)
)+
labs(y="Crude Oil (MMbbl/d)",x="Year",
title=paste("US Crude Oil Destination by Region"),
#subtitle=paste("Production appears as sourced from within a PADD, so PADD 2 production is oil from PADD 2 in PADD 2"),
caption="Source: EIA API, graph by Andrew Leach.")
print(moves_out)
#extract legend
#https://github.com/hadley/ggplot2/wiki/Share-a-legend-between-two-ggplot2-graphs
g_legend<-function(a.gplot){
tmp <- ggplot_gtable(ggplot_build(a.gplot))
leg <- which(sapply(tmp$grobs, function(x) x$name) == "guide-box")
legend <- tmp$grobs[[leg]]
return(legend)}
#grab the legend without a title
mylegend<-arrangeGrob(g_legend(moves_out + theme(legend.title = element_blank(),
legend.spacing = unit(1.0, 'cm'),
legend.text =  element_text(margin = margin(t = 0, r = 1, b = 0, l = 0)))))
plot<-grid.arrange(arrangeGrob(moves_in +labs(caption="Note: Production denoted as supply from within the PADD, e.g. PADD 2 production appears as PADD 2 supply from PADD 2.")+
theme(legend.position="none",
legend.margin=margin(c(0,0,0,0),unit="cm"),
legend.text = element_text(colour="black", size = 14, face = "bold"),
plot.caption = element_text(size = 10,face = "plain", colour="black"),
plot.title = element_text(size = 12,face = "bold", colour="black"),
plot.subtitle = element_blank(),
panel.grid.minor = element_blank(),
text = element_text(size = 10,face = "bold"),
axis.text = element_text(size =12,face = "bold", colour="black"),
axis.text.x = element_blank(),
axis.title.x = element_blank(),
strip.text = element_text(colour="black", size = 8, face = "bold"),
),
moves_out+ labs(caption = "Source: Data via EIA, graph by Andrew Leach")+
theme(legend.position="none",
plot.title = element_text(size = 12,face = "bold", colour="black"),
plot.subtitle = element_blank(),
plot.caption = element_blank(),
panel.grid.minor = element_blank(),
text = element_text(size = 10,face = "bold"),
axis.text = element_text(size = 12,face = "bold", colour="black"),
axis.title.x = element_blank(),
strip.text = element_text(colour="black", size = 8, face = "bold"),
axis.title.y = element_text(margin = margin(t = 0, r = 10, b = 0, l = 0))),
ncol=1,heights=c(3,3)),
mylegend,
nrow=2,heights=c(10, 1),
bottom =text_grob(
"Source: Data via EIA, graph by Andrew Leach",
face = "italic", color = "black",size=10,hjust=0.5,vjust=0.5,lineheight = 2
)
#,
#top =text_grob(
#  "US PADD-to-PADD Crude Oil Movements",
#  face = "bold", color = "black",size=14,just="center",lineheight = 1
#)
#
)
ggsave(plot = plot,"movements.png",dpi=300,bg="white",width = 14,height=8)
